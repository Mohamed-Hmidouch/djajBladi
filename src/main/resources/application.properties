# Application (Heroku sets PORT)
spring.application.name=djaj-bladi-backend
server.port=${PORT:8081}

# Default to noredis (in-memory cache) when SPRING_PROFILES_ACTIVE unset → Koyeb etc. work without Redis.
# Set SPRING_PROFILES_ACTIVE=default (or omit noredis) when Redis is available (e.g. Docker Compose).
spring.profiles.active=${SPRING_PROFILES_ACTIVE:noredis}

# Database ✅ Heroku buildpack sets SPRING_DATASOURCE_* from DATABASE_URL
spring.datasource.url=${SPRING_DATASOURCE_URL:${DATABASE_URL:jdbc:postgresql://localhost:5432/djaj_bladi}}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:${DATABASE_USERNAME:postgres}}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:${DATABASE_PASSWORD:postgres}}
spring.datasource.driver-class-name=org.postgresql.Driver

# HikariCP Configuration ✅ (Connection Pooling)
spring.datasource.hikari.maximum-pool-size=${HIKARI_MAX_POOL_SIZE:10}
spring.datasource.hikari.minimum-idle=${HIKARI_MIN_IDLE:5}
spring.datasource.hikari.connection-timeout=${HIKARI_CONNECTION_TIMEOUT:30000}
spring.datasource.hikari.idle-timeout=${HIKARI_IDLE_TIMEOUT:600000}
spring.datasource.hikari.max-lifetime=${HIKARI_MAX_LIFETIME:1800000}

# JPA Configuration ✅ (explicit dialect for cloud when JDBC metadata unavailable)
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.open-in-view=false

# Flyway Configuration ✅
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-version=0
spring.flyway.validate-on-migrate=true

# Redis Configuration ✅ (skip when profile "noredis" – use SimpleCacheConfig)
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.cache.type=redis
spring.cache.redis.time-to-live=600000

# JWT Configuration ✅ (always set JWT_SECRET in production)
app.jwt.secret=${JWT_SECRET:dev-only-secret-change-in-production}
app.jwt.expiration=${JWT_EXPIRATION:86400000}
app.jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION:604800000}

# Actuator ✅ (health,info only – never include *)
management.endpoints.web.exposure.include=health,info

# Logging
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.flywaydb=DEBUG
